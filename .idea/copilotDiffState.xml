<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/ARCHITECTURE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/ARCHITECTURE.md" />
              <option name="updatedContent" value="# Estructura del Proyecto MQTT Client&#10;&#10;Este documento describe la organización del código de la aplicación MQTT Client.&#10;&#10;##  Estructura de Archivos&#10;&#10;```&#10;app/src/main/java/com/example/home/&#10;│&#10;├── MainActivity.kt                      # Actividad principal&#10;├── MqttHelper.kt                        # Cliente MQTT (ya existente)&#10;│&#10;├── models/&#10;│   └── ReceivedMessage.kt              # Modelo de datos para mensajes&#10;│&#10;└── ui/&#10;    ├── MqttApp.kt                      # Pantalla principal con navegación&#10;    │&#10;    ├── screens/&#10;    │   ├── ConnectionTab.kt            # Pestaña de conexión&#10;    │   ├── SubscriptionTab.kt          # Pestaña de suscripción&#10;    │   └── PublishTab.kt               # Pestaña de publicación&#10;    │&#10;    └── theme/&#10;        └── ...                         # Temas de la app (ya existente)&#10;```&#10;&#10;##  Descripción de Componentes&#10;&#10;###  MainActivity.kt&#10;**Responsabilidad**: Gestión del ciclo de vida y coordinación&#10;&#10;- Maneja el ciclo de vida de la aplicación (`onCreate`, `onDestroy`)&#10;- Gestiona la instancia de `MqttHelper`&#10;- Persiste y carga datos con `SharedPreferences`&#10;- Implementa conexión automática al iniciar&#10;- Delega operaciones MQTT a métodos específicos (`handleConnect`, `handlePublish`, etc.)&#10;&#10;**Métodos principales**:&#10;- `handleConnect()` - Conecta al broker MQTT&#10;- `handleDisconnect()` - Desconecta del broker&#10;- `handlePublish()` - Publica mensajes&#10;- `handleSubscribe()` - Se suscribe a topics&#10;- `handleUnsubscribe()` - Se desuscribe de topics&#10;- `loadPreferences()` - Carga configuración guardada&#10;- `savePreferences()` - Guarda configuración actual&#10;- `connectAutomatically()` - Reconexión automática&#10;&#10;---&#10;&#10;###  ui/MqttApp.kt&#10;**Responsabilidad**: Pantalla principal y navegación&#10;&#10;- Contiene el `Scaffold` principal con `TopAppBar`&#10;- Implementa sistema de pestañas (`TabRow`)&#10;- Maneja el estado global de la UI (conexión, suscripciones, mensajes)&#10;- Coordina la navegación entre pestañas&#10;- Distribuye callbacks a las pantallas hijas&#10;&#10;**Estado gestionado**:&#10;- Datos de conexión (serverUri, username, password)&#10;- Estado de conexión (isConnected)&#10;- Topics de suscripción y publicación&#10;- Lista de mensajes recibidos&#10;- Pestaña seleccionada&#10;&#10;---&#10;&#10;###  ui/screens/ConnectionTab.kt&#10;**Responsabilidad**: Configuración de conexión MQTT&#10;&#10;**Componentes**:&#10;- `ConnectionTab()` - Composable principal&#10;- `ConnectionConfigCard()` - Card con formulario de conexión&#10;- `ConnectionInfoCard()` - Card con información de ayuda&#10;&#10;**Funcionalidades**:&#10;- Campos de entrada para URI, usuario y contraseña&#10;- Botones de conectar/desconectar&#10;- Indicador visual de estado de conexión&#10;- Tips sobre tipos de conexión (tcp://, ssl://, mqtts://)&#10;- Información sobre persistencia automática&#10;&#10;---&#10;&#10;###  ui/screens/SubscriptionTab.kt&#10;**Responsabilidad**: Suscripción y visualización de mensajes&#10;&#10;**Componentes**:&#10;- `SubscriptionTab()` - Composable principal&#10;- `SubscriptionControlCard()` - Control de suscripciones&#10;- `MessagesHeaderCard()` - Header de mensajes con contador&#10;- `MessageCard()` - Card individual de mensaje&#10;&#10;**Funcionalidades**:&#10;- Campo de entrada para topic de suscripción&#10;- Botones de suscribirse/desuscribirse&#10;- Lista de topics activos suscritos&#10;- Visualización de mensajes recibidos con:&#10;  - Topic del mensaje&#10;  - Payload (contenido)&#10;  - Timestamp formateado&#10;- Botón para limpiar historial de mensajes&#10;- Mensaje cuando no hay mensajes&#10;&#10;---&#10;&#10;###  ui/screens/PublishTab.kt&#10;**Responsabilidad**: Publicación de mensajes MQTT&#10;&#10;**Componentes**:&#10;- `PublishTab()` - Composable principal&#10;- `PublishControlCard()` - Formulario de publicación&#10;- `PublishInfoCard()` - Tips sobre publicación&#10;&#10;**Funcionalidades**:&#10;- Campo de entrada para topic de publicación&#10;- Campo de texto multilínea para el mensaje&#10;- Botón de publicar (habilitado solo si hay conexión y datos)&#10;- Consejos sobre:&#10;  - Publicación sin suscripción&#10;  - Topics jerárquicos&#10;  - Entrega a suscriptores&#10;&#10;---&#10;&#10;###  models/ReceivedMessage.kt&#10;**Responsabilidad**: Modelo de datos&#10;&#10;```kotlin&#10;data class ReceivedMessage(&#10;    val topic: String,&#10;    val payload: String,&#10;    val timestamp: Long = System.currentTimeMillis()&#10;)&#10;```&#10;&#10;Representa un mensaje MQTT recibido con su metadata.&#10;&#10;---&#10;&#10;##  Flujo de Datos&#10;&#10;### Conexión:&#10;```&#10;Usuario → ConnectionTab → MqttApp → MainActivity.handleConnect() → MqttHelper.connect()&#10;```&#10;&#10;### Suscripción:&#10;```&#10;Usuario → SubscriptionTab → MqttApp → MainActivity.handleSubscribe() → MqttHelper.subscribe()&#10;```&#10;&#10;### Recepción de Mensajes:&#10;```&#10;MqttHelper → callback → handleSubscribe → MqttApp (actualiza lista) → SubscriptionTab (muestra)&#10;```&#10;&#10;### Publicación:&#10;```&#10;Usuario → PublishTab → MqttApp → MainActivity.handlePublish() → MqttHelper.publish()&#10;```&#10;&#10;### Persistencia:&#10;```&#10;onDestroy → savePreferences() → SharedPreferences&#10;onCreate → loadPreferences() → SharedPreferences → connectAutomatically()&#10;```&#10;&#10;---&#10;&#10;##  Ventajas de esta Arquitectura&#10;&#10;### ✅ Separación de Responsabilidades&#10;- Cada archivo tiene una única responsabilidad clara&#10;- Fácil de entender y mantener&#10;&#10;### ✅ Modularidad&#10;- Los componentes son independientes&#10;- Fácil de testear individualmente&#10;- Reutilización de componentes&#10;&#10;### ✅ Escalabilidad&#10;- Agregar nuevas pantallas es simple (nueva pestaña)&#10;- Agregar funcionalidades no afecta otros componentes&#10;- Estructura preparada para crecimiento&#10;&#10;### ✅ Mantenibilidad&#10;- Código organizado y documentado&#10;- Búsqueda rápida de funcionalidades&#10;- Modificaciones aisladas&#10;&#10;### ✅ Legibilidad&#10;- Nombres descriptivos&#10;- Jerarquía clara&#10;- Documentación inline&#10;&#10;---&#10;&#10;## ️ Convenciones de Código&#10;&#10;### Nombres de Archivos&#10;- `PascalCase` para clases y archivos&#10;- Sufijo `Tab` para pantallas de pestañas&#10;- Sufijo `Card` para componentes de UI&#10;&#10;### Organización de Composables&#10;- Composable público principal primero&#10;- Composables privados después con prefijo `private`&#10;- Ordenados por jerarquía visual&#10;&#10;### Comentarios&#10;- KDoc (`/** */`) para funciones públicas&#10;- Comentarios inline para lógica compleja&#10;- Secciones separadas con comentarios de línea&#10;&#10;### Parámetros&#10;- Estados como `remember { mutableStateOf() }`&#10;- Callbacks con prefijo `on` (onConnect, onPublish, etc.)&#10;- Nombres descriptivos y claros&#10;&#10;---&#10;&#10;##  Próximas Mejoras Sugeridas&#10;&#10;1. **ViewModel**: Separar la lógica de negocio de la UI&#10;2. **Repository**: Abstraer el acceso a datos y preferencias&#10;3. **Dependency Injection**: Usar Hilt o Koin&#10;4. **Testing**: Tests unitarios y de UI&#10;5. **Encriptación**: Usar EncryptedSharedPreferences para credenciales&#10;6. **Estados**: Implementar sealed classes para estados de UI&#10;7. **Navigation**: Usar Jetpack Navigation si se agregan más pantallas&#10;8. **Logging**: Sistema de logs estructurado&#10;&#10;---&#10;&#10;##  Recursos&#10;&#10;- [Jetpack Compose](https://developer.android.com/jetpack/compose)&#10;- [Material 3 Design](https://m3.material.io/)&#10;- [MQTT Protocol](https://mqtt.org/)&#10;- [Eclipse Paho](https://www.eclipse.org/paho/)&#10;&#10;---&#10;&#10;*Última actualización: 2025-11-15*&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/home/ui/MqttApp.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/home/ui/MqttApp.kt" />
              <option name="updatedContent" value="package com.example.home.ui&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Modifier&#10;import com.example.home.models.ReceivedMessage&#10;import com.example.home.ui.screens.ConnectionTab&#10;import com.example.home.ui.screens.PublishTab&#10;import com.example.home.ui.screens.SubscriptionTab&#10;&#10;/**&#10; * Pantalla principal de la aplicación MQTT&#10; * Contiene la navegación por pestañas y maneja el estado global de la app&#10; */&#10;@OptIn(ExperimentalMaterial3Api::class)&#10;@Composable&#10;fun MqttApp(&#10;    initialServerUri: String = &quot;tcp://broker.hivemq.com:1883&quot;,&#10;    initialUsername: String = &quot;&quot;,&#10;    initialPassword: String = &quot;&quot;,&#10;    initialSubscribeTopic: String = &quot;test/topic&quot;,&#10;    initiallyConnected: Boolean = false,&#10;    onConnect: (String, String, String) -&gt; Unit,&#10;    onDisconnect: () -&gt; Unit,&#10;    onPublish: (String, String) -&gt; Unit,&#10;    onSubscribe: (String, (String, String) -&gt; Unit) -&gt; Unit,&#10;    onUnsubscribe: (String) -&gt; Unit,&#10;    checkConnection: () -&gt; Boolean&#10;) {&#10;    // Estado de conexión&#10;    var serverUri by remember { mutableStateOf(initialServerUri) }&#10;    var username by remember { mutableStateOf(initialUsername) }&#10;    var password by remember { mutableStateOf(initialPassword) }&#10;    var isConnected by remember { mutableStateOf(initiallyConnected) }&#10;&#10;    // Estado de suscripción&#10;    var subscribeTopic by remember { mutableStateOf(initialSubscribeTopic) }&#10;    var subscribedTopics by remember { mutableStateOf(setOf&lt;String&gt;()) }&#10;    var messages by remember { mutableStateOf(listOf&lt;ReceivedMessage&gt;()) }&#10;&#10;    // Estado de publicación&#10;    var publishTopic by remember { mutableStateOf(initialSubscribeTopic) }&#10;    var publishMessage by remember { mutableStateOf(&quot;Hello MQTT!&quot;) }&#10;&#10;    // Estado de navegación&#10;    var selectedTab by remember { mutableStateOf(0) }&#10;    val tabs = listOf(&quot;Conexión&quot;, &quot;Suscripción&quot;, &quot;Publicación&quot;)&#10;&#10;    Scaffold(&#10;        topBar = {&#10;            Column {&#10;                TopAppBar(&#10;                    title = { Text(&quot;MQTT Client&quot;) },&#10;                    colors = TopAppBarDefaults.topAppBarColors(&#10;                        containerColor = MaterialTheme.colorScheme.primaryContainer,&#10;                        titleContentColor = MaterialTheme.colorScheme.onPrimaryContainer&#10;                    )&#10;                )&#10;                TabRow(selectedTabIndex = selectedTab) {&#10;                    tabs.forEachIndexed { index, title -&gt;&#10;                        Tab(&#10;                            selected = selectedTab == index,&#10;                            onClick = { selectedTab = index },&#10;                            text = { Text(title) }&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    ) { paddingValues -&gt;&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(paddingValues)&#10;        ) {&#10;            when (selectedTab) {&#10;                0 -&gt; ConnectionTab(&#10;                    serverUri = serverUri,&#10;                    username = username,&#10;                    password = password,&#10;                    isConnected = isConnected,&#10;                    onServerUriChange = { serverUri = it },&#10;                    onUsernameChange = { username = it },&#10;                    onPasswordChange = { password = it },&#10;                    onConnect = {&#10;                        onConnect(serverUri, username, password)&#10;                        isConnected = true&#10;                    },&#10;                    onDisconnect = {&#10;                        onDisconnect()&#10;                        isConnected = false&#10;                        subscribedTopics = setOf()&#10;                    }&#10;                )&#10;                1 -&gt; SubscriptionTab(&#10;                    subscribeTopic = subscribeTopic,&#10;                    isConnected = isConnected,&#10;                    subscribedTopics = subscribedTopics,&#10;                    messages = messages,&#10;                    onSubscribeTopicChange = { subscribeTopic = it },&#10;                    onSubscribe = {&#10;                        onSubscribe(subscribeTopic) { topic, msg -&gt;&#10;                            messages = messages + ReceivedMessage(topic, msg)&#10;                        }&#10;                        subscribedTopics = subscribedTopics + subscribeTopic&#10;                    },&#10;                    onUnsubscribe = {&#10;                        onUnsubscribe(subscribeTopic)&#10;                        subscribedTopics = subscribedTopics - subscribeTopic&#10;                    },&#10;                    onClearMessages = { messages = listOf() }&#10;                )&#10;                2 -&gt; PublishTab(&#10;                    publishTopic = publishTopic,&#10;                    publishMessage = publishMessage,&#10;                    isConnected = isConnected,&#10;                    onPublishTopicChange = { publishTopic = it },&#10;                    onPublishMessageChange = { publishMessage = it },&#10;                    onPublish = {&#10;                        onPublish(publishTopic, publishMessage)&#10;                    }&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/home/ui/screens/ConnectionTab.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/home/ui/screens/ConnectionTab.kt" />
              <option name="updatedContent" value="package com.example.home.ui.screens&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;&#10;/**&#10; * Pestaña de Conexión&#10; * Maneja la configuración y conexión al broker MQTT&#10; */&#10;@Composable&#10;fun ConnectionTab(&#10;    serverUri: String,&#10;    username: String,&#10;    password: String,&#10;    isConnected: Boolean,&#10;    onServerUriChange: (String) -&gt; Unit,&#10;    onUsernameChange: (String) -&gt; Unit,&#10;    onPasswordChange: (String) -&gt; Unit,&#10;    onConnect: () -&gt; Unit,&#10;    onDisconnect: () -&gt; Unit&#10;) {&#10;    LazyColumn(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        item {&#10;            ConnectionConfigCard(&#10;                serverUri = serverUri,&#10;                username = username,&#10;                password = password,&#10;                isConnected = isConnected,&#10;                onServerUriChange = onServerUriChange,&#10;                onUsernameChange = onUsernameChange,&#10;                onPasswordChange = onPasswordChange,&#10;                onConnect = onConnect,&#10;                onDisconnect = onDisconnect&#10;            )&#10;        }&#10;&#10;        item {&#10;            ConnectionInfoCard()&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun ConnectionConfigCard(&#10;    serverUri: String,&#10;    username: String,&#10;    password: String,&#10;    isConnected: Boolean,&#10;    onServerUriChange: (String) -&gt; Unit,&#10;    onUsernameChange: (String) -&gt; Unit,&#10;    onPasswordChange: (String) -&gt; Unit,&#10;    onConnect: () -&gt; Unit,&#10;    onDisconnect: () -&gt; Unit&#10;) {&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = if (isConnected)&#10;                MaterialTheme.colorScheme.primaryContainer&#10;            else&#10;                MaterialTheme.colorScheme.surface&#10;        )&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(16.dp),&#10;            verticalArrangement = Arrangement.spacedBy(8.dp)&#10;        ) {&#10;            Text(&#10;                text = &quot;Configuración de Conexión&quot;,&#10;                fontSize = 20.sp,&#10;                fontWeight = FontWeight.Bold&#10;            )&#10;&#10;            OutlinedTextField(&#10;                value = serverUri,&#10;                onValueChange = onServerUriChange,&#10;                label = { Text(&quot;Broker URI&quot;) },&#10;                modifier = Modifier.fillMaxWidth(),&#10;                enabled = !isConnected,&#10;                singleLine = true,&#10;                placeholder = { Text(&quot;tcp://broker.hivemq.com:1883&quot;) }&#10;            )&#10;&#10;            OutlinedTextField(&#10;                value = username,&#10;                onValueChange = onUsernameChange,&#10;                label = { Text(&quot;Usuario (opcional)&quot;) },&#10;                modifier = Modifier.fillMaxWidth(),&#10;                enabled = !isConnected,&#10;                singleLine = true&#10;            )&#10;&#10;            OutlinedTextField(&#10;                value = password,&#10;                onValueChange = onPasswordChange,&#10;                label = { Text(&quot;Contraseña (opcional)&quot;) },&#10;                modifier = Modifier.fillMaxWidth(),&#10;                enabled = !isConnected,&#10;                singleLine = true&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;            ) {&#10;                Button(&#10;                    onClick = onConnect,&#10;                    enabled = !isConnected,&#10;                    modifier = Modifier.weight(1f)&#10;                ) {&#10;                    Text(&quot;Conectar&quot;)&#10;                }&#10;&#10;                Button(&#10;                    onClick = onDisconnect,&#10;                    enabled = isConnected,&#10;                    modifier = Modifier.weight(1f),&#10;                    colors = ButtonDefaults.buttonColors(&#10;                        containerColor = MaterialTheme.colorScheme.error&#10;                    )&#10;                ) {&#10;                    Text(&quot;Desconectar&quot;)&#10;                }&#10;            }&#10;&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;&#10;            Text(&#10;                text = if (isConnected) &quot;✓ Conectado&quot; else &quot;✗ Desconectado&quot;,&#10;                color = if (isConnected) Color(0xFF4CAF50) else Color(0xFFF44336),&#10;                fontWeight = FontWeight.Bold,&#10;                fontSize = 16.sp&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun ConnectionInfoCard() {&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = MaterialTheme.colorScheme.surfaceVariant&#10;        )&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(16.dp),&#10;            verticalArrangement = Arrangement.spacedBy(8.dp)&#10;        ) {&#10;            Text(&#10;                text = &quot;ℹ️ Información&quot;,&#10;                fontSize = 18.sp,&#10;                fontWeight = FontWeight.Bold&#10;            )&#10;            Text(&#10;                text = &quot;• Los datos de conexión se guardan automáticamente\n&quot; +&#10;                       &quot;• Al reiniciar la app, se conectará automáticamente\n&quot; +&#10;                       &quot;• Usa tcp:// para conexiones no seguras\n&quot; +&#10;                       &quot;• Usa ssl:// o mqtts:// para conexiones seguras&quot;,&#10;                fontSize = 14.sp,&#10;                color = MaterialTheme.colorScheme.onSurfaceVariant&#10;            )&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/home/ui/screens/PublishTab.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/home/ui/screens/PublishTab.kt" />
              <option name="updatedContent" value="package com.example.home.ui.screens&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;&#10;/**&#10; * Pestaña de Publicación&#10; * Permite publicar mensajes a topics MQTT&#10; */&#10;@Composable&#10;fun PublishTab(&#10;    publishTopic: String,&#10;    publishMessage: String,&#10;    isConnected: Boolean,&#10;    onPublishTopicChange: (String) -&gt; Unit,&#10;    onPublishMessageChange: (String) -&gt; Unit,&#10;    onPublish: () -&gt; Unit&#10;) {&#10;    LazyColumn(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        item {&#10;            PublishControlCard(&#10;                publishTopic = publishTopic,&#10;                publishMessage = publishMessage,&#10;                isConnected = isConnected,&#10;                onPublishTopicChange = onPublishTopicChange,&#10;                onPublishMessageChange = onPublishMessageChange,&#10;                onPublish = onPublish&#10;            )&#10;        }&#10;&#10;        item {&#10;            PublishInfoCard()&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun PublishControlCard(&#10;    publishTopic: String,&#10;    publishMessage: String,&#10;    isConnected: Boolean,&#10;    onPublishTopicChange: (String) -&gt; Unit,&#10;    onPublishMessageChange: (String) -&gt; Unit,&#10;    onPublish: () -&gt; Unit&#10;) {&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth()&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(16.dp),&#10;            verticalArrangement = Arrangement.spacedBy(8.dp)&#10;        ) {&#10;            Text(&#10;                text = &quot;Publicar Mensaje&quot;,&#10;                fontSize = 20.sp,&#10;                fontWeight = FontWeight.Bold&#10;            )&#10;&#10;            if (!isConnected) {&#10;                Text(&#10;                    text = &quot;⚠️ Debes conectarte primero&quot;,&#10;                    color = MaterialTheme.colorScheme.error,&#10;                    fontSize = 14.sp&#10;                )&#10;            }&#10;&#10;            OutlinedTextField(&#10;                value = publishTopic,&#10;                onValueChange = onPublishTopicChange,&#10;                label = { Text(&quot;Topic&quot;) },&#10;                modifier = Modifier.fillMaxWidth(),&#10;                enabled = isConnected,&#10;                singleLine = true,&#10;                placeholder = { Text(&quot;test/topic&quot;) }&#10;            )&#10;&#10;            OutlinedTextField(&#10;                value = publishMessage,&#10;                onValueChange = onPublishMessageChange,&#10;                label = { Text(&quot;Mensaje&quot;) },&#10;                modifier = Modifier.fillMaxWidth(),&#10;                enabled = isConnected,&#10;                minLines = 4,&#10;                maxLines = 8,&#10;                placeholder = { Text(&quot;Escribe tu mensaje aquí...&quot;) }&#10;            )&#10;&#10;            Spacer(modifier = Modifier.height(8.dp))&#10;&#10;            Button(&#10;                onClick = onPublish,&#10;                enabled = isConnected &amp;&amp; publishTopic.isNotBlank() &amp;&amp; publishMessage.isNotBlank(),&#10;                modifier = Modifier.fillMaxWidth()&#10;            ) {&#10;                Text(&quot;Publicar&quot;, fontSize = 16.sp)&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun PublishInfoCard() {&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = MaterialTheme.colorScheme.surfaceVariant&#10;        )&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(16.dp),&#10;            verticalArrangement = Arrangement.spacedBy(8.dp)&#10;        ) {&#10;            Text(&#10;                text = &quot;ℹ️ Consejos&quot;,&#10;                fontSize = 18.sp,&#10;                fontWeight = FontWeight.Bold&#10;            )&#10;            Text(&#10;                text = &quot;• Puedes publicar en cualquier topic\n&quot; +&#10;                       &quot;• No necesitas estar suscrito para publicar\n&quot; +&#10;                       &quot;• El mensaje se enviará a todos los suscriptores del topic\n&quot; +&#10;                       &quot;• Usa topics jerárquicos: casa/sala/luz&quot;,&#10;                fontSize = 14.sp,&#10;                color = MaterialTheme.colorScheme.onSurfaceVariant&#10;            )&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/home/ui/screens/SubscriptionTab.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/home/ui/screens/SubscriptionTab.kt" />
              <option name="updatedContent" value="package com.example.home.ui.screens&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.example.home.models.ReceivedMessage&#10;import java.text.SimpleDateFormat&#10;import java.util.Date&#10;import java.util.Locale&#10;&#10;/**&#10; * Pestaña de Suscripción&#10; * Permite suscribirse a topics y visualizar mensajes recibidos&#10; */&#10;@Composable&#10;fun SubscriptionTab(&#10;    subscribeTopic: String,&#10;    isConnected: Boolean,&#10;    subscribedTopics: Set&lt;String&gt;,&#10;    messages: List&lt;ReceivedMessage&gt;,&#10;    onSubscribeTopicChange: (String) -&gt; Unit,&#10;    onSubscribe: () -&gt; Unit,&#10;    onUnsubscribe: () -&gt; Unit,&#10;    onClearMessages: () -&gt; Unit&#10;) {&#10;    LazyColumn(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        item {&#10;            SubscriptionControlCard(&#10;                subscribeTopic = subscribeTopic,&#10;                isConnected = isConnected,&#10;                subscribedTopics = subscribedTopics,&#10;                onSubscribeTopicChange = onSubscribeTopicChange,&#10;                onSubscribe = onSubscribe,&#10;                onUnsubscribe = onUnsubscribe&#10;            )&#10;        }&#10;&#10;        item {&#10;            MessagesHeaderCard(&#10;                messageCount = messages.size,&#10;                onClearMessages = onClearMessages&#10;            )&#10;        }&#10;&#10;        items(messages.reversed()) { message -&gt;&#10;            MessageCard(message = message)&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun SubscriptionControlCard(&#10;    subscribeTopic: String,&#10;    isConnected: Boolean,&#10;    subscribedTopics: Set&lt;String&gt;,&#10;    onSubscribeTopicChange: (String) -&gt; Unit,&#10;    onSubscribe: () -&gt; Unit,&#10;    onUnsubscribe: () -&gt; Unit&#10;) {&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth()&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(16.dp),&#10;            verticalArrangement = Arrangement.spacedBy(8.dp)&#10;        ) {&#10;            Text(&#10;                text = &quot;Suscripción a Topics&quot;,&#10;                fontSize = 20.sp,&#10;                fontWeight = FontWeight.Bold&#10;            )&#10;&#10;            if (!isConnected) {&#10;                Text(&#10;                    text = &quot;⚠️ Debes conectarte primero&quot;,&#10;                    color = MaterialTheme.colorScheme.error,&#10;                    fontSize = 14.sp&#10;                )&#10;            }&#10;&#10;            OutlinedTextField(&#10;                value = subscribeTopic,&#10;                onValueChange = onSubscribeTopicChange,&#10;                label = { Text(&quot;Topic&quot;) },&#10;                modifier = Modifier.fillMaxWidth(),&#10;                enabled = isConnected,&#10;                singleLine = true,&#10;                placeholder = { Text(&quot;test/topic&quot;) }&#10;            )&#10;&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.spacedBy(8.dp)&#10;            ) {&#10;                Button(&#10;                    onClick = onSubscribe,&#10;                    enabled = isConnected &amp;&amp; subscribeTopic.isNotBlank(),&#10;                    modifier = Modifier.weight(1f)&#10;                ) {&#10;                    Text(&quot;Suscribirse&quot;)&#10;                }&#10;&#10;                Button(&#10;                    onClick = onUnsubscribe,&#10;                    enabled = isConnected &amp;&amp; subscribeTopic in subscribedTopics,&#10;                    modifier = Modifier.weight(1f),&#10;                    colors = ButtonDefaults.buttonColors(&#10;                        containerColor = MaterialTheme.colorScheme.secondary&#10;                    )&#10;                ) {&#10;                    Text(&quot;Desuscribirse&quot;)&#10;                }&#10;            }&#10;&#10;            if (subscribedTopics.isNotEmpty()) {&#10;                Spacer(modifier = Modifier.height(8.dp))&#10;                Text(&#10;                    text = &quot;Suscrito a:&quot;,&#10;                    fontWeight = FontWeight.Bold,&#10;                    fontSize = 14.sp&#10;                )&#10;                subscribedTopics.forEach { topic -&gt;&#10;                    Text(&#10;                        text = &quot;• $topic&quot;,&#10;                        fontSize = 13.sp,&#10;                        color = MaterialTheme.colorScheme.primary&#10;                    )&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun MessagesHeaderCard(&#10;    messageCount: Int,&#10;    onClearMessages: () -&gt; Unit&#10;) {&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth()&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(16.dp),&#10;            verticalArrangement = Arrangement.spacedBy(8.dp)&#10;        ) {&#10;            Row(&#10;                modifier = Modifier.fillMaxWidth(),&#10;                horizontalArrangement = Arrangement.SpaceBetween,&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                Text(&#10;                    text = &quot;Mensajes Recibidos ($messageCount)&quot;,&#10;                    fontSize = 20.sp,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;&#10;                if (messageCount &gt; 0) {&#10;                    TextButton(onClick = onClearMessages) {&#10;                        Text(&quot;Limpiar&quot;)&#10;                    }&#10;                }&#10;            }&#10;&#10;            if (messageCount == 0) {&#10;                Text(&#10;                    text = &quot;No hay mensajes recibidos&quot;,&#10;                    color = MaterialTheme.colorScheme.onSurfaceVariant,&#10;                    modifier = Modifier.padding(vertical = 8.dp)&#10;                )&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;private fun MessageCard(message: ReceivedMessage) {&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = MaterialTheme.colorScheme.secondaryContainer&#10;        )&#10;    ) {&#10;        Column(&#10;            modifier = Modifier.padding(12.dp),&#10;            verticalArrangement = Arrangement.spacedBy(4.dp)&#10;        ) {&#10;            Text(&#10;                text = &quot;Topic: ${message.topic}&quot;,&#10;                fontWeight = FontWeight.Bold,&#10;                fontSize = 14.sp,&#10;                color = MaterialTheme.colorScheme.primary&#10;            )&#10;            Text(&#10;                text = message.payload,&#10;                fontSize = 14.sp&#10;            )&#10;            Text(&#10;                text = SimpleDateFormat(&quot;HH:mm:ss&quot;, Locale.getDefault())&#10;                    .format(Date(message.timestamp)),&#10;                fontSize = 11.sp,&#10;                color = MaterialTheme.colorScheme.onSurfaceVariant&#10;            )&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>